// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = "mysql://root:password@127.0.0.1:3307/ticket?connection_limit=20&socket_timeout=5"
}

model Movie {
  id          String   @id @db.VarChar(36)
  title       String   @db.VarChar(255)
  releaseDate DateTime @db.Date()
  createdAt   DateTime
  plays       Play[]
}

model Play {
  id           String        @id @db.VarChar(36)
  movie        Movie         @relation(fields: [movieId], references: [id])
  movieId      String        @db.VarChar(36)
  screen       Screen        @relation(fields: [screenId], references: [id])
  screenId     String        @db.VarChar(36)
  reservations Reservation[]
  datetime     DateTime
}

model Theater {
  id      String   @id @db.VarChar(36)
  address String
  screens Screen[]
}

model Screen {
  id        String         @id @db.VarChar(36)
  name      String
  theater   Theater        @relation(fields: [theaterId], references: [id])
  theaterId String         @db.VarChar(36)
  seats     Seat[]
  plays     Play[]
  options   ScreenOption[]
}

model ScreenOption {
  id         String @id @db.VarChar(36)
  name       String
  extraPrice Int
  screen     Screen @relation(fields: [screenId], references: [id])
  screenId   String @db.VarChar(36)
}

model Seat {
  id           String        @id @db.VarChar(36)
  number       String
  screen       Screen        @relation(fields: [screenId], references: [id])
  screenId     String        @db.VarChar(36)
  reservations Reservation[]
}

model Reservation {
  id         String                @id @db.VarChar(36)
  price      Int
  play       Play                  @relation(fields: [playId], references: [id])
  playId     String                @db.VarChar(36)
  seat       Seat                  @relation(fields: [seatId], references: [id])
  seatId     String                @db.VarChar(36)
  customer   Customer              @relation(fields: [customerId], references: [id])
  customerId String                @db.VarChar(36)
  discounts  ReservationDiscount[]

  @@unique([playId, seatId])
}

model ReservationDiscount {
  id            String      @id @db.VarChar(36)
  reservation   Reservation @relation(fields: [reservationId], references: [id])
  reservationId String      @db.VarChar(36)
  discount      Discount    @relation(fields: [discountId], references: [id])
  discountId    String      @db.VarChar(36)
}

model Discount {
  id                  String                @id @db.VarChar(36)
  name                String
  price               Int
  resrvationDiscounts ReservationDiscount[]
}

model Customer {
  id           String        @id @db.VarChar(36)
  name         String
  birth        DateTime      @db.Date()
  reservations Reservation[]
}
